task_function.c
#include "../include/threadpool.h"
#include <stdio.h>

typedef struct
{
    int num;
    long long result;
} task_arg_t;

void factorial(void *arg)
{
    task_arg_t *task_arg = (task_arg_t *)arg;
    int num = task_arg->num;
    long long result = 1;
    for (int i = 2; i <= num; i++)
    {
        result *= i;
    }
    task_arg->result = result;
    printf("Factorial of %d is %lld\n", num, result);
}

void square(void *arg)
{
    task_arg_t *task_arg = (task_arg_t *)arg;
    int num = task_arg->num;
    long long result = (long long)num * num;
    task_arg->result = result;
    printf("Square of %d is %lld\n", num, result);
}

task_function.h
#ifndef TASK_FUNCTIONS_H
#define TASK_FUNCTIONS_H

typedef struct
{
    int num;
    long long result;
} task_arg_t;

void factorial(void *arg);
void square(void *arg);

#endif // TASK_FUNCTIONS_H

main.c
#include "../include/threadpool.h"
#include "../include/task_functions.h"

int main()
{
    thread_pool_t *pool = thread_pool_create(4, 8); // 4 threads, 8 queue size.

    task_arg_t args[4];
    for (int i = 0; i < 4; i++)
    {
        args[i].num = (i + 1) * 5; // 5, 10, 15, 20.
        thread_pool_add_task(pool, factorial, &args[i]);
        thread_pool_add_task(pool, square, &args[i]);
    }

    // Cleanup.
    thread_pool_cleanup(pool);

    return 0;
}

test.c
#include "../include/threadpool.h"
#include "../include/task_functions.h"
#include <assert.h>

void test_factorial_and_square()
{
    thread_pool_t *pool = thread_pool_create(4, 8); // 4 threads, 8 queue size.

    task_arg_t args[4];
    for (int i = 0; i < 4; i++)
    {
        args[i].num = (i + 1) * 5; // 5, 10, 15, 20.
        thread_pool_add_task(pool, factorial, &args[i]);
        thread_pool_add_task(pool, square, &args[i]);
    }

    // Cleanup the thread pool and wait for all tasks to finish.
    thread_pool_cleanup(pool);

    // Validate results
    long long expected_factorials[4] = {120, 3628800, 1307674368000, 2432902008176640000};
    long long expected_squares[4] = {25, 100, 225, 400};

    for (int i = 0; i < 4; i++)
    {
        // Assert factorials
        assert(args[i].result == expected_factorials[i]);
        printf("Test passed for factorial of %d: %lld\n", args[i].num, args[i].result);

        // Reset result and compute square again for validation
        square(&args[i]);
        assert(args[i].result == expected_squares[i]);
        printf("Test passed for square of %d: %lld\n", args[i].num, args[i].result);
    }
}

int main()
{
    test_factorial_and_square();
    printf("All tests passed.\n");
    return 0;
}


Makefile
# Compiler and flags
CC = gcc
CFLAGS = -pthread -Wall

# Directories
SRC_DIR = src
INCLUDE_DIR = include
TEST_DIR = test

# Source files
SRC_FILES = $(SRC_DIR)/threadpool.c $(SRC_DIR)/task_functions.c $(SRC_DIR)/main.c
TEST_FILE = $(TEST_DIR)/test.c

# Executable names
EXEC = threadpool_example
TEST_EXEC = test_example

# Default target
all: $(EXEC)

# Build main program
$(EXEC): $(SRC_FILES)
	$(CC) $(CFLAGS) -I$(INCLUDE_DIR) -o $(EXEC) $(SRC_FILES)

# Build and run tests
test: $(SRC_FILES) $(TEST_FILE)
	$(CC) $(CFLAGS) -I$(INCLUDE_DIR) -o $(TEST_EXEC) $(SRC_FILES) $(TEST_FILE)
	./$(TEST_EXEC)

# Clean up
clean:
	rm -f $(EXEC) $(TEST_EXEC)
