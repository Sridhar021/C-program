#include "../include/threadpool.h"
#include <stdio.h>

typedef struct
{
    int num;
    long long result;
} task_arg_t;

// Function to compute factorial
void factorial(void *arg)
{
    task_arg_t *task_arg = (task_arg_t *)arg;
    int num = task_arg->num;
    long long result = 1;
    for (int i = 2; i <= num; i++)
    {
        result *= i;
    }
    task_arg->result = result;
    printf("Factorial of %d is %lld\n", num, result);
}

// Function to compute square
void square(void *arg)
{
    task_arg_t *task_arg = (task_arg_t *)arg;
    int num = task_arg->num;
    long long result = (long long)num * num;
    task_arg->result = result;
    printf("Square of %d is %lld\n", num, result);
}

int main()
{
    thread_pool_t *pool = thread_pool_create(4, 8); // 4 threads, 8 queue size.

    task_arg_t args[4];
    for (int i = 0; i < 4; i++)
    {
        args[i].num = (i + 1) * 5; // 5, 10, 15, 20.
        thread_pool_add_task(pool, factorial, &args[i]);
        thread_pool_add_task(pool, square, &args[i]);
    }

    // Cleanup.
    thread_pool_cleanup(pool);

    return 0;
}
